!function(a){const s=wp.hooks.applyFilters("utm_event_tracker_has_pro",!1),t={Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]};var e={template:"#utm-pagination",props:{totalItems:{type:Number,default:0},currentPage:{type:Number,default:1},perPage:{type:Number,default:20}},data(){return{item_per_page:this.perPage}},watch:{item_per_page(){this.$emit("changePage",parseInt(this.item_per_page),"per_page")}},computed:{get_total_pages(){return Math.ceil(this.totalItems/this.perPage)},get_pages(){const e=parseInt(this.get_total_pages);var t=parseInt(this.currentPage);let s=[1,2,e-1,e-2,e,t];return s.push(t-2),s.push(t-1),s.push(t+1),s.push(t+2),s=s.filter(t=>0<t&&t<=e),(s=[...new Set(s)].sort()).sort((t,e)=>t-e),s},has_last_page(){return this.currentPage<this.get_total_pages},get_last_page_number(){return this.get_total_pages}},methods:{go_page(t){t<1||t>this.get_last_page_number||this.$emit("changePage",t)}}},r={template:"#utm-keywords-stats",props:{param:"",type:{default:"session"},dates:{default:[moment().subtract(15,"days"),moment()]},showReportDate:{default:!1}},data(){return{error:null,keywords:[],loading:!0}},computed:{get_date(){return this.dates[0].format("MMM DD, YYYY")+" - "+this.dates[1].format("MMM DD, YYYY")},get_keywords_stats(){return!0===s?this.keywords:this.keywords.slice(0,2)},hided_keywords_count(){var t=this.keywords.length-this.get_keywords_stats.length;return 0<=t?t:0}},mounted(){this.load_data()},watch:{dates(){this.load_data()}},methods:{get_color(t){let e=["#f35d82","#6ad49b","#9c27b0","#8757ed","#5ba6ff"];return(e=!0!==s?["#f35d82","#6ad49b","transparent","transparent","transparent"]:e)[t]},load_data(){this.error=null,this.loading=!0;var t=new FormData;t.append("stats_type",this.type),t.append("parameter",this.param),t.append("end_date",this.dates[1]||""),t.append("start_date",this.dates[0]||""),t.append("_wpnonce",this.$refs.nonce.value),t.append("action","utm_event_tracker/get_keywords_stats"),fetch(utm_event_tracker.ajax_url,{method:"POST",body:t}).then(t=>t.json()).then(t=>{!(this.loading=!1)===t.success?this.keywords=t.data:(this.keywords=[],this.error=t.data.error)}).catch(t=>{})}}},o={template:"#session-summary",props:["session"],methods:{close_summary(){this.$emit("close")}},computed:{lock_event_count(){return!0===s?0:parseInt(this.session.total_events)-this.session.events.length}}},n={components:{"utm-overview-widget":{template:"#utm-overview-widget",props:{param:{type:String,required:!0}},data(){return{data:[],loading:!0,type:"keywords",sort_desc:"asc",order_by:"sessions",dates:[moment().subtract(6,"days"),moment()]}},mounted(){const s=this;a(this.$refs.datepicker).daterangepicker({startDate:s.dates[0],endDate:s.dates[1],locale:{format:"MMM DD, YYYY"},ranges:t},function(t,e){s.dates=[t,e]}),this.fetch_data()},watch:{dates(){this.fetch_data()},type(){this.fetch_data()}},computed:{get_report(){return this.sort_desc?"date"===this.order_by?this.data.sort((t,e)=>e[this.order_by]>t[this.order_by]?1:-1):this.data.sort((t,e)=>e[this.order_by]-t[this.order_by]):"date"===this.order_by?this.data.sort((t,e)=>t[this.order_by]-e[this.order_by]?1:-1):this.data.sort((t,e)=>t[this.order_by]-e[this.order_by])},is_empty(){return 0==this.data.length}},methods:{get_date_text(){return this.dates[0].format("MMM DD, YYYY")+" - "+this.dates[1].format("MMM DD, YYYY")},fetch_data(){this.loading=!0;var t=new FormData;t.append("action","utm_event_tracker/get_keywords_report"),"date"===this.type&&t.append("action","utm_event_tracker/get_date_report"),t.append("param",this.param),t.append("_wpnonce",this.$refs.nonce.value),t.append("start_date",this.dates[0].format()),t.append("end_date",this.dates[1].format()),fetch(utm_event_tracker.ajax_url,{method:"POST",body:t}).then(t=>t.json()).then(t=>{this.loading=!1,this.data=Array.isArray(t.data)?t.data:[]}).catch(t=>{this.data=[]})},sort_report(t){t===this.order_by&&(this.sort_desc=!this.sort_desc),this.order_by=t},get_sort_column_class(t){return this.order_by!==t?"":this.sort_desc?"sort-desc":"sort-asc"}}}},data(){return{first_load:!0,hide_widgets:[],show_overview_setting:!1}},created(){var t=document.getElementById("utm-overview-container");try{var e=JSON.parse(t.getAttribute("data-settings"));"object"==typeof e&&(void 0!==e.hide_widgets&&Array.isArray(e.hide_widgets)||(e.hide_widgets=[]),this.hide_widgets=e.hide_widgets)}catch(t){}},mounted(){const e=this;this.first_load=!1,a(document).keyup(function(t){"Escape"===t.key&&a("#overview-settings").length&&(e.show_overview_setting=!1)}),a("#overview-settings").on("click",function(t){a(t.target).closest("#overview-settings .popup-content").length||(e.show_overview_setting=!1)})},methods:{widget_is_visible(t){return this.hide_widgets.includes(t)},update_widget_visibility(t){var e=this.hide_widgets,s=e.indexOf(t);-1<s?e.splice(s,1):e.push(t),this.hide_widgets=e},get_visibility_class(t){return this.hide_widgets.includes(t)?"utm-event-tracker-icon-eye-slash":"utm-event-tracker-icon-eye"},save_settings(){if(!this.first_load){const e=new FormData;e.append("_wpnonce",this.$refs.nonce.value),e.append("action","utm_event_tracker/update_overview_settings"),this.hide_widgets.forEach(t=>{e.append("hide_widgets[]",t)}),fetch(utm_event_tracker.ajax_url,{method:"POST",body:e})}}},watch:{hide_widgets:{handler(){this.save_settings()},deep:!0}}},n=(a("#utm-overview-container").length&&Vue.createApp(n).mount("#utm-overview-container"),{template:"#session-list-keywords",props:{column:{type:String,default:"utm_campaign"},dates:{default:[moment().subtract(15,"days"),moment()]},keywords:{default:""}},data(){return{page:1,data:[],timer:null,per_page:10,loading:!0,total_items:0,sort_type:"DESC",view_session:null,sort_column:"created_on",session_type:"individual"}},components:{"utm-pagination":e,"session-summary":o},mounted(){const e=this;this.load_data(),a(document).keyup(function(t){"Escape"===t.key&&a("#session-details-container").length&&(e.view_session=null)}),a(document).on("click",function(t){a(t.target).closest("#session-details-container").length||null!==e.view_session&&(e.view_session=null)})},watch:{dates(){this.load_data()},keywords(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.page=1,this.load_data()},500)}},computed:{get_data(){return this.data},is_empty(){return 0===this.data.length},get_total_session_events(){return this.view_session.total_events}},methods:{set_session(e){this.view_session=this.data.filter(t=>t.id==e)[0]},get_date_label(){return this.dates[0].format("MMM DD, YYYY")+" - "+this.dates[1].format("MMM DD, YYYY")},sort_report(t){t===this.sort_column&&("DESC"===this.sort_type?this.sort_type="ASC":this.sort_type="DESC"),this.sort_column=t,this.load_data()},get_sort_column_class(t){return this.sort_column!==t?"":"DESC"===this.sort_type?"sort-desc":"sort-asc"},load_data(){this.loading=!0;var t=new FormData;t.append("page",this.page),t.append("column",this.column),t.append("per_page",this.per_page),t.append("keywords",this.keywords),t.append("sort_type",this.sort_type),t.append("sort_column",this.sort_column),t.append("session_type",this.session_type),t.append("end_date",this.dates[1].format()),t.append("_wpnonce",this.$refs.nonce.value),t.append("start_date",this.dates[0].format()),t.append("action","utm_event_tracker/get_sessions"),fetch(utm_event_tracker.ajax_url,{method:"POST",body:t}).then(t=>t.json()).then(t=>{this.loading=!1,this.total_items=parseInt(t.data.total),this.data=Array.isArray(t.data.items)?t.data.items:[]}).catch(t=>{this.loading=!1})},updatePagination(t,e="page"){"page"===e&&(this.page=t),"per_page"===e&&(this.page=1,this.per_page=t),this.load_data()},close_summary(){this.view_session=null}}}),e={components:{"session-list":{extends:n,template:"#session-list",data(){return{session_type:"all"}}},"session-list-keywords":n,"utm-keywords-stats":r},data(){return{timer:null,keywords:"",dates:[moment().subtract(14,"days"),moment()]}},mounted(){const s=this;a(this.$refs.datepicker).daterangepicker({startDate:s.dates[0],endDate:s.dates[1],locale:{format:"MMM DD, YYYY"},ranges:t},function(t,e){s.dates=[t,e]})},methods:{reload(){this.$refs.keyword_list_table.load_data()}}};a("#session-list-report").length&&Vue.createApp(e).mount("#session-list-report"),a("#utm-campaigns-session-report").length&&Vue.createApp(e).mount("#utm-campaigns-session-report"),a("#utm-medium-session-report").length&&Vue.createApp(e).mount("#utm-medium-session-report"),a("#utm-source-session-report").length&&Vue.createApp(e).mount("#utm-source-session-report"),a("#utm-content-session-report").length&&Vue.createApp(e).mount("#utm-content-session-report"),a("#utm-term-session-report").length&&Vue.createApp(e).mount("#utm-term-session-report")}(jQuery);